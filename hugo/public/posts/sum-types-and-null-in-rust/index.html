<!doctype html>
<html lang="en-us">
  <head>
    <title>Sum Types and Null in Rust // Aashray&#39;s Blog</title>
    <link rel="shortcut icon" href="/favicon.ico" />
    <meta charset="utf-8" />
    <meta name="generator" content="Hugo 0.88.1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="Aashray Anand" />
    <meta name="description" content="A few words here and there about what I&#39;m up to." />
    <link rel="stylesheet" href="/css/main.min.e3e673b07e6fcbedc1992304863ca607d598988089b7f690a51a8297034a9c03.css" />

    
    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Sum Types and Null in Rust"/>
<meta name="twitter:description" content="A few words here and there about what I&#39;m up to."/>

    <meta property="og:title" content="Sum Types and Null in Rust" />
<meta property="og:description" content="A few words here and there about what I&#39;m up to." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/sum-types-and-null-in-rust/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-12-29T11:17:20-08:00" />
<meta property="article:modified_time" content="2021-12-29T11:17:20-08:00" />



  </head>
  <body>
    <header class="app-header">
      <a href="/"><img class="app-header-avatar" src="/avatar.jpg" alt="Aashray Anand" /></a>
      <h1>Aashray&#39;s Blog</h1>
      <p>Software engineer, writing about what I do in my free time</p>
      <div class="app-header-social">
        
          <a href="https://github.com/AashrayAnand/" target="_blank" rel="noreferrer noopener">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github">
  <title>Github</title>
  <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
</svg>
          </a>
        
          <a href="https://twitter.com/anand_aashray" target="_blank" rel="noreferrer noopener">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-twitter">
  <title>Twitter</title>
  <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path>
</svg>
          </a>
        
      </div>
    </header>
    <main class="app-container">
      
  <article class="post">
    <header class="post-header">
      <h1 class ="post-title">Sum Types and Null in Rust</h1>
      <div class="post-meta">
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar">
  <title>calendar</title>
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line>
</svg>
          Dec 29, 2021
        </div>
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock">
  <title>clock</title>
  <circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>
</svg>
          4 min read
        </div>
      </div>
    </header>
    <div class="post-content">
      <p>Sum types are definitely a step in a different direction for rust from C-style languages.
They let you define an <em>enumeration of types</em>, and then create instance of these enumerations which are
one of the set of types they specify. See an example below (of a binary search tree definition)</p>
<pre><code>pub enum Tree&lt;T&gt; {
    TreeNode(T, Box&lt;TreeNode&lt;T&gt;&gt;, Box&lt;TreeNode&lt;T&gt;&gt;),
    Nil
}
</code></pre>
<p>What we see here is an example of using an enum to indicate that an instance of a Tree can take on
one of a set of fixed types, either a TreeNode, or Nil. Let&rsquo;s also make it explicitly clear that
Nil is not a primitive type of rust, and rather, this is a locally defined type, and is distinct from what
we think of as Nil/Null in other languages.</p>
<p>The above sum type can be thought of as similar to the
below C++ structure definition</p>
<pre><code>template &lt;typename T&gt; struct TreeNode {
    TreeNode* left,
    TreeNode* right,
    T         val
};
</code></pre>
<p>The difference being, in C++, we would imagine that the above structure will always have the
same concrete type (TreeNode), but can possibly be a null pointer (having no useful value). In rust,
the equivalent to this is to instead have different concrete types for a non-null vs. null TreeNode,
and wrap these into a single enumerable sum type.</p>
<p>In fact, the idea of sum types highlights another big difference between rust and many other languages,
which is that there is no actual null value as we tend to understand it.</p>
<p>This is an amzing thing! After all, Tony Hoare, the Turing award winner, developer of one of the first comprehensive
<a href="https://en.wikipedia.org/wiki/ALGOL">type systems</a> and the man credited for creating the null pointer, has called
it his &ldquo;one billion dollar mistake&rdquo;, for all of the resulting errors, vulnerabilities, and crashes it has lead to
in systems based on languages which include null references, and do not have any defined behavior for these cases.
It&rsquo;s all because in languages with nullable types, we don&rsquo;t truly know what something is, and we need to always be wary of
whether it truly can be treated as the concrete type it specifies, or not. It&rsquo;s like hiding all of your bleongings in
trash bags, not knowing whether the contents of a bag are going to be something useful, or just a bunch of trash!</p>
<p>This is where rust has remedied much of this disaster, as failing to distinguish between the different concrete
types of a sum type, such as an Option, causes a compile time error, rather than the run time errors we are used
to in languages like C or C++ where a null pointer check is missed. That is, an instance of a rust sum type is
explicitly (from its type) some value of use, or some garbage value, but can be known as one or the other just from
its underlying type. No more trash pretending to be treasure!.</p>
<p>To understand this best, it&rsquo;s best to look at rust&rsquo;s ubiquitous Option sum type. It is the de-facto sum type used to
represent values in rust that may or not exist.</p>
<pre><code>pub enum Option&lt;T&gt; {
    None,
    Some(T)
}
</code></pre>
<p>This is just a more generalized form of what we have defined in our TreeNode enum. Option is a sum type, where we
either have a value T with type Some, or we have no value with type None. The ambiguity of whether a value with a
concrete type X having an underlying value that can actually be interpreted as this type is completely gone!</p>
<p>Consider the equivalent to this sum type in C++, which instead has a single type with nullable values. If we were to
miss our null pointer check for case below, then the behavior we get is undefined, and is only exposed at runtime.</p>
<pre><code>int* bad_value = buggy_function_sometimes_null();
int* good_value = buggy_function_sometimes_null();
</code></pre>
<p>In comparison, rust won&rsquo;t ever even allow garbage values to masquerade as a valuable type like this case, see the alternative
below using options vs a nullable type.</p>
<p><img src="/option_type_bad_code.png" alt="option_type_bad_code"></p>
<p>Then, if we have a case of some buggy code like above, where we try to use some value that is &ldquo;null&rdquo; (or better said,
an instance of the None type), the <strong>compiler</strong> will stop us, and require we explicitly ensure that
we are interacting with the correct concrete type.</p>
<p><img src="/option_type_error.png" alt="option_type_error"></p>
<p>No longer can a missed null check slip by! (see the fixed code below)</p>
<p><img src="/option_type_good_code.png" alt="option_type_good_code"></p>
<p><a href="https://blog.waleedkhan.name/union-vs-sum-types/">Some more good reading</a> about union and sum types, one of the many functional programming features to grow into heavy favor</p>

    </div>
    <div class="post-footer">
      
    </div>
  </article>

    </main>
  </body>
</html>
